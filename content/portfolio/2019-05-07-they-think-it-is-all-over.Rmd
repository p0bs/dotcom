---
title: "Is it all over?"
author: "Robin Penfold"
date: "2019-05-07"
showonlyimage: false
draft: false
slug: "they-think-it-is-all-over"
image: "img/portfolio/PPlogo.jpg"
description: "Projecting the competition winner one week out"
weight: 2
output:
  blogdown::html_page:
    highlight: pygments
---

</br>

"Some people are on the pitch. They think it's all over ..." 

But it isn't. It could be Roger or Luke.

</br>

## Current standings

Let's start with the current standings:

```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}
library(premPredictor)
suppressMessages(library(tidyverse))

iterations <- 10000
  
player_info <- "https://www.dropbox.com/s/uin6zk4w5cyk2m1/PremPredict-18-19.csv"
player_data <- get_player_data(url_value = player_info)

odds_info <- "https://www.dropbox.com/s/cb5qyxyexksvez1/odds.csv"
odds_data <- get_odds_data(url_value = odds_info)

get_latest_standings(data_input = player_data, use_saved_data = T, data_file = 'data/201819_penultimate.rds')
```

</br>

## Who will win PremPredict?

But here's what we really want to know: What are our chances of winning? 

```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}
project_players <- get_projection(
  url_odds = odds_info,
  url_predictions = player_info,
  project_players = TRUE,
  use_saved_data = T,
  data_file = "data/201819_penultimate.rds",
  runs = iterations)

winPlayer <- as.data.frame(project_players==1L)

winLikelihood <- as.data.frame(
  apply(winPlayer, 2, sum)
)

winSummary <- tibble(
  Name = colnames(project_players), 
  Frequency = pull(winLikelihood, 1)) %>% 
  filter(Frequency > 0) %>% 
  arrange(-Frequency) %>%
  mutate(Likelihood = Frequency/iterations) %>%
  select(Name, Likelihood)

winSummary
```
  

Well, unless your name is Roger or Luke then the answer is zero. (Or, more specifically, in the 10,000 scenarios that I ran, you didn't win any of them.)

</br>

## Who will win the Premier League?

By the way, these calculations also show who the bookies feel will be champions. 

```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}
project_team <- get_projection(
  url_odds = odds_info, 
  url_predictions = player_info, 
  project_players = FALSE,
  use_saved_data = T,
  data_file = "data/201819_penultimate.rds",
  runs = iterations)

project_team %>% 
  select(Liverpool, `Man City`) %>% 
  count(Liverpool, `Man City`) %>% 
  mutate(chance = n / sum(n)) %>% 
  arrange(desc(chance))
```

</br>

## Does each player depend upon a team to win?

By the way, these calculations also show who the bookies feel will be champions. 

```{r eval=TRUE, echo=TRUE, message=FALSE, warning=FALSE}
bind_cols(winPlayer, project_team) %>% 
  select(Roger.Gathercole, Luke.Finnis, `Man City`, Liverpool) %>% 
  count(Roger.Gathercole, Luke.Finnis, `Man City`, Liverpool) %>% 
  mutate(chance = n / sum(n)) %>% 
  arrange(`Man City`, desc(chance))
```
