---
title: "Best commutes to Reigate"
author: "Robin Penfold"
date: "2015-10-18"
type: "post"
showonlyimage: false
draft: false
slug: "best-commutes"
image: "img/portfolio/commute.jpg"
description: "What are the best places to live if you work in Reigate?"
weight: 4
output:
  blogdown::html_page:
    highlight: pygments
---

A friend at work was recently hoping to buy his first house and asked me where to look. "That depends on what you need", I said, like a typical consultant. But it got me thinking. 

Knowing the criteria in question, I had some general views, but they didn't even convince me. So I turned to data (from Microsoft MapPoint for the commuting times and otherwise from the excellent [UK Data Service](https://www.ukdataservice.ac.uk/)). Fortunately, I could scrape data on the criteria I sought for all English districts:

  - Commuting time by car (weight of 15) 
  
  - Average age of the district's residents (weight of 1)
  
  - Typical cost of housing in the district (weight of 6)
  
  - Level of deprivation in the district (weight of 6), which also reflects crime and educational achievement

That said, at some point, I might investigate more measures -- perhaps by constituency. 

I then pulled all this together into a weighted score and mapped it. And, thinking optimistically, it must have helped my friend, as he ended-up buying a property in district rated as highly desirable.

Here are the results (with Reigate marked as the small red dot):

```{r thecodec, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE, error=FALSE}
library(tidyverse)
library(sf)
  
geography <- sf::st_read(
  "data/Lower_Layer_Super_Output_Areas_December_2011_Super_Generalised_Clipped__Boundaries_in_England_and_Wales.dbf")
  
st_crs(x = geography) <- 4326
  
data <- read_csv("data/ScoredAreas1a.csv")
  
finalData <- data %>% 
  select(id:IMD.score) %>% 
  mutate_if(is.numeric, funs(scale)) %>% 
  mutate(score =
           ((15 * Time) + 
           Wtd.Ave + 
           (5 * Affordability) + 
           (10 * IMD.score)) * -1) %>% 
  select(id, score) %>% 
  mutate(score = scale(score)) %>% 
  left_join(geography, by = c("id" = "lsoa11cd")) %>% 
  mutate_at(.vars = "score", funs(as.numeric))
  
ggplot(data = finalData) + 
  geom_sf(aes(fill = score, colour = score)) + 
  scale_fill_continuous(type = "viridis") + 
  scale_colour_continuous(type = "viridis") +
  annotate("point",
           x = 520000,
           y = 160000,
           colour = "red",
           size = 0.2) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),
    axis.text.y = element_blank()
  )
```

<br></br>

I've also built this [Shiny app](http://robin.shinyapps.io/location) to add interaction to this map, enabling users to alter the weights and select only coastal regions, should they wish. 

And here's the code for the map above:

```{r thecodec, eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
```


<p>&nbsp;</p>

---
