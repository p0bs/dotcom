---
title: "Who bats best?"
author: "Robin Penfold"
date: "2018-10-09"
showonlyimage: false
draft: false
slug: "batting"
image: "img/portfolio/bat.jpg"
description: "Where in the order have the best batsmen batted?"
weight: 2
output:
  blogdown::html_page:
    highlight: pygments
---

Cricket commentators often bang on about changes in batting quality through the ages. Or they say that batting order matters to averages ... or vice-versa. But is there anything in these questions? In this post, I try and find out a bit.

I've downloaded the top 200 averages for each batting order from the wonderful stats engine at [espnCricinfo](http://stats.espncricinfo.com/ci/engine/stats/index.html). I've then excluded averages from players with fewer than twenty innings. I've also only considered results against Australia, England, India, New Zealand, Pakistan, South Africa, Sri Lanka and the West Indies.

Here are the charts and the associated code. 

Some things to note: 

  * There are actually many charts, each representing a different batting order (from 1 to 11)
  
  * Each player represents a different dot in a chart. Some players appear in more than one chart, as they batted a lot in different positions in the order
  
  * The colour of a dot shows the country that the player represented
  
  * The vertical position of a dot shows the player's average
  
  * The horizontal position of a dot shows the decade in which the player's career began

<br></br>

First, I tidy the data that I received from espnCricinfo.

```{r, error=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(gganimate)
library(glue)
library(plotly)
theme_set(theme_bw())
  
batOrder <- read_csv("data/BattingOrder.csv") %>% 
  mutate(
    Name = word(Player, start = 1L, end = -2L),
    fullCountry = word(Player, -1),
    Country = str_sub(fullCountry, 2,-2)) %>% 
  filter(
    Country %in% c("Aus", "Ban", "Eng", "India", "NZ", "Pak", "SA", "SL", "WI")
    ) %>% 
  mutate(
    Start = as.integer(str_sub(Span, 1, 4)),
    Decade = 10*trunc(Start/10)
    ) %>% 
  select(Name, Country, Start, Decade, Ave, Innings = Inns, Runs, Bat)

glimpse(batOrder)
```

</br>

Next, I create the animation, using the splendid `gganimate`.

```{r, eval=FALSE, error=TRUE, message=FALSE, warning=FALSE}
batOrder %>% 
  ggplot(
    aes(
      x = Decade,
      y = Ave,
      color = Country, 
      size = Innings
      )
    ) +
  geom_point(alpha = 1) +
  labs(
    x = "Last decade of the batsman's career",
    y = ""
    ) +
  ggtitle(
    'The 200 best players who have ever batted at {closest_state} in the order',
    subtitle = 'Average when batting at that position'
    ) + 
  transition_states(
    states = Bat,
    transition_length = 2,
    state_length = 1
    ) + 
  ease_aes('cubic-in-out') 
```

</br> 

![](/portfolio/output.gif)

```{r, error=TRUE, message=FALSE, warning=FALSE}
p1 <- batOrder %>% 
  ggplot(
    aes(
      x = Decade, 
      y = Ave, 
      text = Name, 
      color = Country
      )
    ) + 
  geom_point() + 
  facet_wrap(~ Bat) +
  labs(
    x = "", 
    title = "", 
    y = ""
    ) + 
  theme(legend.position="none")
  
# config(displayModeBar = F, 
#        displaylogo = F,
#        showLink = F,
#        p = p1)
#   
p1 <- ggplotly(p1)

layout(p1, hovermode = "closest")
```

I think the results are interesting. It doesn't seem like averages have changed that much over time (although the number of lower-order players with more than twenty innings has increased over the decades).

That said, batting order matters. Whether that's a self-fulfilling prophecy or not is harder to measure, but it matters -- particularly when you get to eighth or ninth. Players coming in at seven, eight and nine seem to have improved over the decades, although the sample is small.
