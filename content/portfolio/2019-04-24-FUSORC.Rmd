---
title: "My R code snippets"
author: "Robin Penfold"
date: "2019-04-24"
showonlyimage: false
draft: false
slug: "FUSORC"
description: "Helpful shortcuts"
image: "img/portfolio/R.jpg"
weight: 2
output:
  blogdown::html_page:
    highlight: pygments
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
```

Granted, *FUSORC* (Frequently Used Snippets Of R Code) isn't as catchy as *FAQ*. However, I keep a list of FUSORC that I find valuable and -- in the spirit of the R community -- thought it best to share.

Here goes ...

</br>

#### Begin an R notebook

I use the following code to start an R notebook.

```{r, eval=FALSE}
---
title: ""
author: "Robin Penfold"
date: ""
output: 
  html_notebook:
    theme: sandstone
    highlight: pygments
    code_folding: "show"
    toc: true
    toc_float: true
    toc_depth: 4
---

***

### Introduction

Add ...

```

I also reduce the ouput by adding the following to the first code chunk (and setting `message` to `FALSE`):

```{r, eval=FALSE}
suppressMessages(library(tidyverse))
```

</br>

#### Count outcomes

Simple but frequently used.

```{r}
mtcars %>% 
  count(cyl, gear)

mtcars %>%
  count(cyl, gear) %>%
  count(gear)
```

</br>

#### Mutate in bulk

```{r, eval=FALSE}
iris %>% 
  mutate_at(
    .cols = vars(-Species),
    .funs = funs(. * 100)
    )
```

As with the previous shortcut, I often need to mutate all but a few columns. Running the code directly above multiplies all columns in `iris` by 100 except for the `Species`. As with many of these snippets, the example shows the principle, which can be applied in many ways.

</br>

#### Reduce ifelse calls

Taken from [Advanced R](https://adv-r.hadley.nz) by Hadley Wickham, this infix function provides a default value in the case where the output of another function is `NULL`.

```{r, eval=FALSE}
library(rlang)

# `%||%` <- function(a, b) if (!is.null(a)) a else b

function_that_might_return_NULL() %||% default_value
```

</br>


#### Scrape web data

I tend to use the format `read_html(index_page) %>% html_nodes("a") %>% html_attr("href")`. (You also need to be outside a corporate firewall to do this.)

```{r}
library(rvest)
library(xml2)

read_html("http://www.theguardian.com/football/premierleague/table") %>%
  html_nodes(".table--striped") %>%
  .[[1]] %>%
  html_table() %>% 
  select(Team:Pts) %>% 
  head()
```

</br>

#### Select some columns

I often need to select all but a few columns that end in a certain way. 

```{r}
iris %>%
  select(
    everything(), 
    -ends_with("Width")
    ) %>%
  head()  
```

</br>

#### Show ggplot2 in Rmd

This code chunk metadata enables a ggplot2 object to appear nicely in Rmarkdown.

> ```{r, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE, fig.show='hold', fig.width = 6, fig.asp=0.618, out.width="70%", fig.align="center"}```

</br>

#### Summarise tidily

Do you ever need to summarise all columns in a dataframe using certain functions. I find this shortcut really helpful for doing so in a tidy way.

```{r}
mtcars %>% 
  map_df(
    .x = .,
    .f = ~tibble(
      sum = sum(.x),
      iqr = IQR(.x),
      min = min(.x)
      ),
    .id = "var_name"
    )
```

</br>

#### Translate dplyr to SQL

Even better, you can choose the dialect of SQL!

```{r, message=FALSE}
library(dplyr)
library(dbplyr)

df <- tibble(
  y = c('a', 'b', 'c'), 
  z = c(2, 3, 4)
  )

x <- tbl_lazy(
  df, 
  con = simulate_mssql()
  )

x %>% 
  filter(y != 'a') %>% 
  summarise(x = sd(z, na.rm = TRUE)) %>% 
  show_query()
```


</br>

#### Miscellanea

  *  Use `recode` and `recode_factor`

</br>

---
